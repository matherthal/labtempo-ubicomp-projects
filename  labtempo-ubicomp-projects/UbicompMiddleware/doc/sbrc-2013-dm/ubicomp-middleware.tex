\documentclass[12pt]{article}

\usepackage{sbc-template}

\usepackage{graphicx,url}
\usepackage[space]{grffile}

\usepackage[brazil]{babel}   
\usepackage[latin1]{inputenc}  

     
\sloppy

\title{Um \textit{Framework} de Desenvolvimento de Aplicações Ubíquas em Ambientes Inteligentes}
%acho q \\ pula linha
\author{Matheus Erthal\inst{1}, Douglas Mareli\inst{1}, David Barreto\inst{1}, Orlando Loques\inst{1}}


\address{Instituto de Computação -- Universidade Federal Fluminense (UFF)\\
  Niterói -- RJ -- Brazil
% \nextinstitute
%   Department of Computer Science -- University of Durham\\
%   Durham, U.K.
% \nextinstitute
%   Departamento de Sistemas e Computação\\
%   Universidade Regional de Blumenal (FURB) -- Blumenau, SC -- Brazil
  \email{\{merthal,dmareli,dbarreto,loques\}@ic.uff.br}
}

\begin{document} 

\maketitle

%%%%%%%%%%%%%%
%  RESUMOS   %
%%%%%%%%%%%%%%
\begin{abstract}

\end{abstract}


\begin{resumo} 

\end{resumo}


%%%%%%%%%%%%%%
% INTRODUÇÃO %
%%%%%%%%%%%%%%
\section{Introdução}
%(motivação: jogar pra cima ubicomp introduzindo a inteligência ambiental como aplicação funamental)
A Computação Ubíqua, como proposta por Weiser na década de 90~\cite{weiser1991computer}, prevê uma mudança no paradigma de interação entre o usuário e os sistemas computacionais. Weiser previu o surgimento do que chamou de "computação calma", onde a interação entre os usuários e os computadores ocorre de forma indireta. Uma aplicação ubíqua identifica as necessidades do usuário obtendo informação de contexto através de sensores, e provê serviços através de atuadores. Este tipo de sistema de aplicações é associado a um espaço denominado ambiente inteligente~\cite{augusto2007ambient}. 

%TODO: (matheus) Douglas, não é melhor colocarmos uma referência para, ao invés de Ambient Inteligence, pq este último só fala de IA... se vc quiser, eu acho q tenho até a referência pra qm criou este termo ``smarthome'', só que isso foi criado num relatório técnico (é difícil de achar, mas eu acho q tenho uma cópia pq pedi à própria autora). 

%TODO:(douglas) Não acho apropriado citar algo diferente do que já vinha sendo citado e aconselhado pelo orlando, e há uma concenso de que smart home é uma instancia de ambientes inteligentes. Quando houver citação do caso específico de smarthome (exemplos) esta referência de ''smarthome'' é bem vinda
   
%(as dificuldades, ?mas desenvolver é caro, difícil?, etc.)
A construção e manipulação de aplicações ubíquas representam um grande desafio para desenvolvedores com pouco conhecimento técnico e recursos escassos. Alguns problemas estão mais em evidência. Na construção e teste de aplicações surge a necessidade de um contingente de recursos como dispositivos embarcados e espaço físico. Também há uma dificuldade de estabelecer um protocolo comum de comunicação entre os componentes do sistema distribuído. E por fim, a interatividade das aplicações ubíquas é dificultada dependendo da quantidade e variedade de informações de contexto disponível no ambiente. Estes são desafios que motivam a proposta de um \textit{framework} com o objetivo de facilitar a aplicação dos conceitos de computação ubíqua em ambientes inteligentes. %TODO: (matheus) Está meio confuso o meio deste parágrafo, depois a gente dá uma olhada

%(o q os outros tem feito, falar rapidamente)
Muitos trabalhos como~\cite{helal2005gator, cardoso2006, ranganathan2005olympus} tentam atingir esse objetivo. Em~\cite{augusto2007ambient} são apontados desafios na aquisição de conhecimentos do ambiente. Em~\cite{helal2005gator} é proposto um \textit{middleware} entre a camada física, a qual compreende os sensores e atuadores, e a camada de aplicação, na qual se encontram o ambiente de desenvolvimento e as aplicações ubíquas. Em~\cite{cardoso2006} são propostos serviços para gerenciar componentes representativos do ambiente no nível de \textit{middleware}. E sabendo-se que um ambiente inteligente pode possuir uma variedade imensa de dispositivos, O trabalho em \cite{ranganathan2005olympus} propõe uma estrutura de representação dos componentes da camada física através de ontologia. Esta estruturação permite ampliar o escopo de operações de suporte sobre um ambiente inteligente.

%(?Este trabalho... vamos propor um protótipo ...?, nosso trabalho tem q ganhar. ?Tem que caber o smartandroid inteiro? - ARs)
Neste trabalho é proposto um \textit{framework} de desenvolvimento de aplicações ubíquas em ambientes inteligentes. O objetivo é dar suporte a programação, teste e execução de aplicações para ambientes inteligentes permitindo lidar de forma consistente com sistemas de grande complexidade. O \textit{framework} destaca-se por cobrir grande parte dos desafios destacados na computação ubíqua \cite{araujo2003} como tratamento da heterogeneidade de dispositivos, tratamento de informações de contexto e descoberta de serviços. A heterogeneidade é tratada através da definição de um modelo de componentes distribuídos, no qual o componente básico tem uma estrutura uniforme definida como um Agente de Recurso (AR). Segundo [Xavier 2006], AR é a entidade de coleta de informações contexto. Neste trabalho, esta definição é ampliada para qualquer módulo que interage com elementos no ambiente inteligente. Para o tratamento de informações de contexto é proposto um modelo de regras que consiste de um conjunto de 
interpretadores de contexto. Além disso, no \textit{framework} é proposto uma aplicação de interface de prototipagem \cite{david2012ipgap} que permite a visualização e o teste de aplicações ubíquas mesclando componentes reais e virtuais. %TODO: (matheus) nós vamos citar a comutação ubíqua com letras maiúsculas ou minúsculas? Temos q decidir de pronto.
%TODO: (matheus) Douglas, nós não vamos citar o david e a ipgap dessa maneira aí. Nós temos que falar que essa parte tb foi submetida para o SBRC 2013

%(mostrar uma prova de conceito: 1 (exatamente) aplicação, seja a de saúde, ou outra)
A qualidade de suporte do \textit{framework} foi avaliada durante o processo de transformação de uma aplicação com funcionamento estritamente local em uma aplicação ubíqua. Com isso foi possível provar conceitualmente que o \textit{framework} facilita o processo de construção de aplicações ubíquas. Para testar a eficiência do modelo de regras foi construída uma aplicação que explora os mecanismos de comunicação utilizados no modelo de componentes distribuídos e as informações básicas de um agente de recurso como localização e identificação de tipo.
  
%(dependendo do tamanho: e nós concluímos que é possível fazer isso, isso e isso)

%(resumo das seções, falar das próximas seções)
Este artigo é organizado da seguinte forma: a Seção 2 apresenta os conceitos básicos utilizados ao longo do texto. A Seção 3 apresenta a arquitetura geral do SmartAndroid incluindo o modelo de componentes distribuídos e de regras. Na Seção 4 é apresentada uma prova de conceito demonstrando a eficiência do \textit{framework} em construir aplicações ubíquas. Após a avaliação, a Seção 5 apresenta uma comparação com trabalhos relacionados. E para finalizar, a Seção 7 apresenta as conclusões e trabalhos futuros.



%%%%%%%%%%%%%%%%
%    BASICO    %
%%%%%%%%%%%%%%%%
\section{Conceitos Básicos}

%[(introduzir e motivar os conceitos abordados por nossa proposta)
Os \textit{frameworks} para aplicações ubíquas costumam utilizar como base os conceitos de Inteligencia Ambiental, de Computação Sensível ao Contexto e de Prototipagem de Aplicações Ubíquas. A Inteligencia Ambiental define o espaço onde estas aplicações funcionam. O comportamento de sistemas ubíquos são definidos a partir de técnicas aplicadas na Computação Sensível ao Contexto. E os esquemas de prototipagem são utilizados para manipular e testar o funcionamento do conjunto de aplicações no ambiente.
  
%(ambientes inteligentes)
A computação ubíqua se inclui dentre as inúmeras áreas abrangidas pela IAmb. Em~\cite{augusto2007ambient} é apresentada uma arquitetura em camadas como base para sistemas em ambientes inteligentes. Na camada mais profunda encontra-se o espaço com seus ocupantes, em uma camada acima estão os sensores captando suas interações e atuadores promovendo interações com estes indivíduos. Uma camada intermediária (\textit{middleware}) é definida entre as tomadas de decisões, as quais podem ocorrer por um ocupante ou mecanismos de inteligencia artificial, e as interações com o ambiente. O \textit{middleware} é a parte que melhor define a função geral de nosso \textit{framework}, as aplicações ubíquas são definidas e gerenciadas nesta camada para promover a ligação entre o ambiente e os serviços computacionais. 
%TODO: (matheus) ATENÇÃO!!!! Está fazendo referência ao IAmb, sigla esta q não está mais sendo criada no 1o paragrafo!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

%smarthome como um tipo de ambiente inteligente
Um ambiente inteligente (AmbI) é o meio onde se agrega inteligencia computacional. Há diversos exemplos na literatura que utilizam especificações deste tipo de ambiente, dentre eles o termo ''smarthome'' (casa inteligente) se mostra como um dos mais populares por ter diversas propostas no estado da arte explorando este tipo de espaço \cite{helal2005gator}\cite{augusto2007ambient}\cite{ranganathan2005olympus}. Estes trabalhos costumam explorar a heterogeneidade de dispositivos e as rotinas bem definidas de seus ocupantes com a casa inteligente como cenário. Apesar do \textit{framework} proposto neste trabalho abranger qualquer tipo de AmbI, boa parte dos exemplos de aplicações abordados tem como cenário este tipo residencial.
 
%(modelo de componentes distrbuídos(agente de recurso como definição de componente básico))]
Para que as aplicações ubíquas possam ser integradas a elementos de baixo nível do AmbI é necessário que este espaço seja representado no nível de \textit{middleware}. Segundo \cite{kramer2007abstraction}, a abstração quando bem definida pode melhorar a visualização de problemas do mundo real e consequentemente ajudar na definição de uma resolução clara e objetiva por meio computacional. Nesta direção, este trabalho define um modelo de componentes arquiteturais distribuídos \cite{brown1998dcom} para representar de forma geral sistemas construídos pelo nosso \textit{framework}.

\subsection{Prototipagem de Aplicações Pervasivas}
%falar sobre travalho do david e da importancia de testar apicaçoes ubíquas
No contexto do \textit{framework}, a prototipagem de aplicações pervasivas é fundamental para a depuração e teste em um AmbI. No trabalho \cite{david2012sbrc} é proposta a Interface de Prototipagem para Aplicações Pervasivas (IPGAP), um aparato ferramental que permite ao desenvolvedor de aplicações ter acesso a esses benefícios. Além disso, a IPGAP possui uma  Interface Gráfica de Usuário (GUI, sigla do inglês) que proporciona ao usuário final controlar remotamente recursos do ambiente.

\begin{figure}[ht]
  \centering
  \includegraphics[width=.8\textwidth]{imgs/ipgap/ipgap.PNG}
  \caption{Interface de Prototipagem}
  \label{fig:ipgap}
\end{figure}

%detalhar elementos da IPGAP
Estas capacidades destacadas são proporcionadas pelas seguintes funcionalidades: mapeamento do ambiente, instalação de novas aplicações ubíquas e ligação com aplicações já existentes. Através destas funcionalidades é possível ter uma ambiente preenchido de recursos simulados (como televisor virtual, geladeira virtual, etc.) e fazê-los executar junto a recursos reais que podem ser representados em sua GUI. A GUI da IPGAP foi elaborada apropriadamente para o universo dos  \textit{tablets} e \textit{smartphones}, nela podem ser visualizados os recursos reais e virtuais localizados no mapa como ilustrado na Figura~\ref{fig:ipgap}.     

%demonstrar uso em nossa proposta com exemplo (vide figura)
Na Figura~\ref{fig:ipgap} é ilustrado um \textit{tablet} executando o aplicativo da IPGAP e \textit{smartphones} simulando recursos como TV, lampada e um termômetro. Através da IPGAP é possível visualizar cada um desses elementos e representá-los no mapa. Repare que na figura há outros recursos além dos representados pelos \textit{smartphones}, estes são recursos criados na própria IPGAP. Com isso o desenvolvedor de aplicações não fica limitado pela disponibilidade de recursos físicos, ou seja, não é preciso ter uma a mesma quantidade de dispositivos disponíveis que uma aplicação exige para que ocorra sua execução.

%(descrever sua utilização na proposta)
O \textit{famework} proposto permite ao desenvolvedor criar aplicações nas dimensões e quantidade que desejar para um ambiente real. A IPGAP permite verificar a viabilidade do funcionamento das aplicações desenvolvidas em ambiente real. As restrições deste ambiente para o representado na IPGAP são semelhantes, o que permite avaliar o desempenho antes da implantação efetiva das aplicações.

\subsection{Computação Sensível ao Contexto}
%introduzir o conceito de contexto
O contexto exerce um papel de fundamental importância na computação ubíqua. Durante a década de 90, diversos autores procuraram definir contexto, muitas delas pouco apuradas. Baseados em definições de autores anteriores, Dey e Abowd~\cite{Dey2001} compuseram a seguinte definição para contexto:

\begin{quotation}
  ``Qualquer informação que pode ser usada para caracterizar a situação de entidades (i.e., pessoa, lugar ou objeto) que são consideradas relevantes para a interação entre um usuário e uma aplicação, incluindo o próprio usuário e aplicação. Contexto é tipicamente a localização, identidade, e estado de pessoas, grupos, e objetos computacionais e físicos''
\end{quotation}

Segundo~\cite{Dey2001} três entidades de contexto foram identificadas como de maior importância, são elas: lugares, pessoas e coisas. No ambiente de uma \textit{smarthome}, ``Lugares'' são os cômodos, os andares de uma edificação, ou espaços em geral; ``Pessoas'' são indivíduos que povoam o ambiente e interagem com o mesmo; e ``Coisas'' são representações virtuais de objetos físicos ou componentes de \textit{software}.

Após a identificação das entidades, são introduzidas quatro categorias de contexto essenciais: identidade, localização, estado e tempo. ``Identidade'' corresponde à identificação única de uma entidade. ``Localização'' não só diz respeito à posição de uma pessoa e sua inserção em uma área ou subárea, mas diz também respeito à proximidade de uma pessoa em relação à outra, ou à uma coisa. ``Estado'' identifica características intrínsecas da entidade (e.g., temperatura de uma sala, sinal vital de uma pessoa). ``Tempo'' é uma informação de contexto quando ajuda a caracterizar a situação, geralmente usado com outras informações de contexto, indicando um instante ou período durante o qual alguma informação contextual é conhecida ou relevante.

%descrever sobre importancia para ambientes inteligentes (áreas relacionadas e aplicações)
Uma meta da aquisição de contexto é determinar o que o usuário está tentando realizar, por exemplo, se uma pessoa sai de casa e deixa a torneira aberta, pode ser que a tenha esquecido. A aquisição do contexto de forma automatizada contribui para a construção de aplicações para ambientes inteligentes que, de outra maneira, seriam inviáveis, por exigir a entrada de dados ou comandos diretamente por parte dos usuários.

%descrever importancia em nossa proposta   
O \textit{framework} proposto neste trabalho oferece uma maneira de se representar os recursos espalhados pelo ambiente e os recursos no nível de \textit{software}, tornando homogênea a comunicação entre os componentes, de tal maneira que é simples se declarar e consultar as informações de contexto. Através de serviços padrões é possível se encontrar as entidades e obter seu contexto, onde esta pesquisa pode ser feita tanto utilizando a identificação da entidade, como o seu tipo ou localização física. A sensibilidade ao contexto é caracterizada pela reação do sistema aos eventos de mudança do contexto, portanto, o \textit{framework} introduz o Interpretador de Contexto

%%%%%%%%%%%%%%%%
%  FRAMEWORK   %
%%%%%%%%%%%%%%%%
\section{Proposta do \textit{Framework}}

%definição geral do framework
O \textit{framework} provê facilidades e padrões de programação a aplicações sensíveis ao contexto focadas em AmbI (incluindo \textit{smarthomes}). O \textit{framework} torna mais transparente as partes da aplicação que envolvem a comunicação, a aquisição de contexto e a localização de recursos no ambiente.

%definição da unidade básica do framework (AR)
Ao invés de se lidar diretamente com sensores e atuadores espalhados no ambiente, o \textit{framework} utiliza, como abstração, componentes chamados Agentes de Recursos+ (AR). Os ARs são elementos de primeira ordem da plataforma, representando recursos de hardware ou software disponíveis no ambiente. Eles têm como responsabilidade coletar as diversas medidas dos sensores ou componentes de software presentes no contexto de execução do das aplicações~\cite{bezerrauso}. Os ARs resolvem a complexidade de tratamento com os componentes de baixo nível e disponibilizam interfaces padrões de interação tanto local como em rede. Nos AmbIs podem ser criados ARs para representar, por exemplo: uma televisão que expõe suas informações de contexto e provê serviços para as aplicações; sensores de temperatura da casa; sensores de vazamento de gás na cozinha; um medidor de pressão arterial; um atuador para fechar as janelas; etc. 

%definiçao de uso geral da AR
O AR é a unidade básica de modularização do ambiente distribuído proposto pelo \textit{framework}, assim sendo, o mesmo pode também ser utilizado na modelagem das aplicações. Se uma aplicação necessita de uma entidade distribuída, pode representá-la através de um AR. Por exemplo, um desenvolvedor poderia construir um jogo, representando através de ARs os jogadores, o tabuleiro, os monstros, recursos do cenário, etc. 

%introduzindo o SGAR
Para possibilitar a comunicação entre os diferentes ARs, o SmartAndroid dispõe de um serviço que gerencia estes recursos, e mantém informações de identificação e localização dos mesmos, dentre outras. Este serviço chama-se Serviço de Gerenciamento de Agentes de Recurso (SGAR) e encontra-se centralizado no ambiente distribuído. Como apresentado na Figura~\ref{fig:suporte}, o SGAR é composto por três componentes, ou serviços: o Serviço de Registro de Recurso (SRR), o Serviço de Descoberta de Recursos (SDR) e o Serviço de Localização de Recursos (SLR). A diferença entre o SDR e o SLR está no fato de que o primeiro se refere à localização na rede de computadores, e o segundo se refere à localização física do dispositivo no ambiente. %TODO: antes de falar isso, enfatizar um pouco o problema da localização

O SGAR tem por objetivo aumentar a visibilidade das informações de contexto dos ARs e tornar a comunicação transparente para o programador das aplicações. 
%TODO: talvez possamos falar aqui mesmo que aplicações poderiam ser instaladas no ambiente e inclusive compartilhar informações

\begin{figure}[ht]
  \centering
  \includegraphics[width=.7\textwidth]{imgs/arq-camadas-interpretador.png}
  \caption{Camada de Interpretação de Regra}
  \label{fig:cmd-intp}
\end{figure}

\subsection{Modelo de Componentes Distribuídos}%falar sobre interfaces de serviços do AR e os serviços de descoberta, registro e localização

%descrever de forma geral o componente distribuido
O modelo de componentes distribuídos mapeia as aplicações ubíquas em um ambiente inteligente genérico. Em geral este mapeamento é dividido em três camadas essenciais: 
\begin{enumerate}
  \item A camada física ou conceitual dos recursos
  \item A camada intermediária (\mbox{\textit{middleware}}) com os ARs dos respectivos recursos e componentes de ciência do contexto (interpretadores)
  \item A camada das aplicações que agregam os componentes do \mbox{\textit{middleware}} em aplicativos. 
\end{enumerate}
O modelo de componentes distribuído pode variar dentre estas camadas de acordo com as aplicações ubíquas implantadas no ambiente.

%descrever um exemplo de modelo de componente distribuído (figura arqGeral)
Na Figura~\ref{fig:arquitetura} exemplifica-se uma \textit{smarthome} sendo gerenciada pelo \textit{framework}. Na camada de recursos estão componentes físicos ou conceituais. Os recursos conceituais são aqueles simulados através de outro tipo de dispositivos (como \textit{smartphones} e \textit{tablets}) ou criados virtualmente através da IPGAP. A figura apresenta como recursos exemplo um televisor, uma cama e um fogão. No \mbox{\textit{middleware}} são apresentados os seus ARs representativos, além do AR de interpretação de contexto para verificar se o fogão foi esquecido ligado por um ocupante da casa. O interpretador verifica se alguém está presente na cama e por quanto tempo o fogão está ligado, se um tempo limite for ultrapassado uma ação é disparada para que o fogão seja desligado. Os ARs referentes a cama e ao fogão coletam os dados destes recursos e os representam na camada do \mbox{\textit{middleware}}, isto permite que estas informações sejam utilizadas pelos componentes da camada da aplicação.

\begin{figure}[ht]
  \centering
  \includegraphics[width=.7\textwidth]{imgs/framework/arquiteturaGeral.PNG}
  \caption{Arquitetura do \textit{Framework}}
  \label{fig:arquitetura}
\end{figure}

%descrever a estrutura do agente 
O AR foi definido para padronizar os componentes de interação do ambiente, e dessa forma resolver questão da heterogeneidade apresentada em \cite{araujo2003}. A estrutura geral do AR é composta por nome único, tipo, localização, código(que define a classe) com variáveis e métodos e uma lista de interessados em informações de contexto. O tipo é definido por uma hierarquia que vai se especializando desde o tipo raiz até o tipo da classe(que representa o código do AR corrente). Todo AR possui como super pai o tipo raiz. A lista de interessados possui registros com dois campos, um com a variável do AR corrente e outro com a referência do outro AR interessado nesta informação. 

%descrição do uso de tipo no framework
A definição de tipo do AR é uma etapa importante para a definição de aplicações ubíquas. Em \cite{ranganathan2005olympus} é utilizado uma ontologia para classificar entidades (como os ARs) para possibilitar consultá-las a partir de propriedades predefinidas. Uma aplicação de apresentação de slides é utilizada como exemplo para ilustrar a importância desta ontologia. A aplicação consiste em mostrar os slides no mesmo cômodo residencial onde uma determinada pessoa encontra-se. Então ao invés de definir dispositivos específicos para realizar esta tarefa, a aplicação consulta por dispositivos com as seguintes propriedades: ser do tipo visual e estar no cômodo onde a pessoa alvo está presente. Assim, quando esta pessoa muda de local, o dispositivo que mostra apresentação passa a ser o correspondente ao mesmo local. Em nossa proposta, o SDR possui a busca por tipo que retorna instancias com propriedades predefinidas, tal como em \cite{ranganathan2005olympus}. A forma de utilização de instancias podem ser dinamicamente definidas por Interpretadores de Contexto (vide Seção~\ref{subsubsec-ic}).

%descrever instancia do agente (figura instanciaAR)
A Figura~\ref{fig:agente} ilustra um exemplo de instancia de AR representando um televisor em ambiente residencial. O nome identifica unicamente a TV no ambiente residencial ("tvDaSala"), a localização é definida como a sala de estar. O tipo "TV", nome da classe corrente, é definido como especialização do tipo "Visual". O código possui as variáveis e as operações específicas da classe. E a lista de interessados possui cada registro representando um interesse, o qual contem o campo da variável e outro campo com o AR interessado na mudança de valor da respectiva variável. Por exemplo, o registro da Figura~\ref{fig:agente} indica que o AR do celular está interessado na mudança de canal da TV. 

\begin{figure}[ht]
  \centering
  \includegraphics[height=.4\textwidth]{imgs/suporte/instanciaAR.PNG}
  \caption{Instância do Agente de Recurso}
  \label{fig:agente}
\end{figure}

%descrever as portas de interação (VC e operações) do AR 
Um AR armazena o seu estado por meio de seus atributos declarados e os expõe através da criação de Variáveis de Contexto (VC), como será visto na Seção~\ref{subsubsec:cv}. Da mesma forma ele pode declarar suas possíveis Operações, como será estudado na mesma seção. Do ponto de vista da arquitetura, as VCs são as portas de saída de informação, e as Operações são as portas de entrada de comando.
%Como pode-se ver na figura, as informações de contexto são armazenadas em variáveis e as funcionalidades de que o recurso dispõe são 
%As variáveis, como representado na Figura~\ref{fig:agente} armazenam o estado do AR, e os métodos do exemplo possibilitam acessar as funcionalidades dos ARs, ou Operações. Através desses recursos, um AR pode expor o acesso à sua informação de contexto através da criação de Variáveis de Contexto
%Em tempo de programação, pode-se declarar quais são 

\subsubsection{Suporte ao Gerenciamento de Recursos} \label{subsubsec-sgr}

%falar sobre uso geral do SGAR (figura Suporte)
O SGAR é o responsável por gerenciar o conjunto de ARs no AmbI. O controle de registro (através do SRR) e descoberta (através do SDR) de ARs segue a ideia geral sobre serviços de registro e descoberta de recursos apresentada em \cite{Cardoso2006}. Neste trabalho foi acrescentado o SLR que tem a função de localização física. A Figura~\ref{fig:suporte} ilustra as principais operações de cada serviço de suporte. O SRR é utilizado para registrar ou remover o registro, o SDR é utilizado na busca e o SLR na localização de ARs. Estas operações manipulam dados representativos dos respectivos ARs no Repositório de Recursos.

\begin{figure}[ht]
  \centering
  \includegraphics[width=.7\textwidth]{imgs/suporte/suporte.PNG}
  \caption{Serviços de Suporte}
  \label{fig:suporte}
\end{figure}

%descrever estrutura de repositorio 
O Repositório de Recursos possui o Diretório de Recursos e o Mapa do ambiente. O Diretório contém os dados dos ARs armazenados conforme o tipo de cada um. Estes dados consistem do nome, tipo, localização e a referência de acesso. A referência de acesso permite a interação através do mecanismo de comunicação por invocação remota (RPC) (vide Seção~\ref{subsec-comunicacao}). O Mapa possui o conjunto de espaços físicos definidos no ambiente. Cada espaço possui uma área e um nome. No caso de uma \textit{smarthome} os cômodos da casa representam estes espaços. Cada entrada do Mapa referencia um conjunto de AR contidos no respectivo espaço como pode ser visto na Figura~\ref{fig:repositorio}.

%descrever exemplo da (figura repositorio)
Na Figura~\ref{fig:repositorio} é apresentada a organização de um conjunto de recursos no Repositório. Neste caso há três recursos registrados, uma TV ("tvDaSala"), e dois \textit{tablets} ("iPadQuarto" e "tabSala"). Os três fazem parte do conjunto de ARs do tipo "Audiovisual", estes tipos funcionam como subdiretórios de recursos. E por fim, o Mapa indexa cada um ao respectivo cômodo indicado pelo atributo de localização.

\begin{figure}[ht]
  \centering
  \includegraphics[height=.6\textwidth]{imgs/suporte/repositorio.png}
  \caption{Repositório de Recursos}
  \label{fig:repositorio}
\end{figure}


%descrever o serviço de registro
O SRR é responsável por adicionar, remover e inclusive atualizar informações sobre os ARs no Repositório de Recursos. Através deste serviço, as aplicações podem adicionar novos tipos no Diretório de Recursos e espaços no Mapa. E em cada AR pode ser atualizada a informação sobre localização neste Mapa.  

%descrever o serviço de descoberta e exemplos
O SDR é responsável por prover acesso as instancias de ARs registradas. O SDR possui três tipos de descobertas: por referência, por nome e por tipo. As consultas por referências e nome podem ou não retornar uma instância única, estes dois tipos de buscas podem ser utilizados quando uma aplicação deseja saber se um AR específico está registrado. As consultas por tipo retornam todos os ARs contidos no subdiretório correspondente. Por exemplo, na Figura~\ref{fig:repositorio} o tipo "Audiovisual" contém três ARs, os quais são "tvDaSala", "iPadQuarto" e "tabSala". Logo, uma consulta neste caso retornaria uma lista contendo as referências para cada um dos três ARs.

%descrever o serviço de localização e exemplos
O SLR além de prover acesso as instâncias de ARs físicas permite obter os ARs mais próximos a um ponto específico do AmbI. A consulta por localização verifica os ARs indexados a um local especificado do Mapa. No exemplo da Figura~\ref{fig:repositorio}, uma consulta por ARs da sala retornaria a "tvDaSala" e o "tabSala". A consulta por proximidade leva em conta a subdivisão de espaços do ambiente. Então quando for consultado qual o AR mais próximo a "tvDaSala", mesmo que o "iPadQuarto" esteja mais próximo fisicamente, "tabSala" será o retornado como mais próximo. Isto ocorre porque os ARs do mesmo cômodo são verificados primeiro, depois são verificados ARs de cômodos vizinhos e assim por diante. Em exemplos de aplicações de notificação de mensagens esta lógica é favorecida, já que uma aplicação de lembrete de remédios vai querer notificar o paciente através do dispositivo visual mais proximamente visível, ou seja, de preferência no mesmo cômodo.

\subsection{Comunicação} \label{subsec-comunicacao}

\begin{figure}[ht]
  \centering
  \includegraphics[width=.7\textwidth]{imgs/com/p_s.png}
  \caption{Esquema de \textit{publish-subscribe}}
  \label{fig:pubsub}
\end{figure}
%TODO: Essa figura está horrível!!!!!!!! Fazer outra!!!!!!!!!!!!!!!!!!

%descriçao do mecanismo p/s 
%A principal forma de comunicação no SmartAndroid é através de um mecanismo de publica-subscreve (\textit{publish-subscribe}), também chamado de comunicação por eventos. Este paradigma corresponde à uma comunicação assíncrona, que envolve o registro de interesse por parte da entidade interessada na entidade de interesse. As entidades são mapeadas no SmartAndroid em ARs, e uma entidade pode registrar seu interesse no contexto de uma outra qualquer, co-localizada ou remota. Conforme o contexto da entidade de interesse varia no tempo, esta notifica aos interessados, que desempenham suas ações relacionadas.

%contextualizaçao da comunicaçao no modelo de componentes distribuídos descriçao do mecanismo p/s 
Foi definido um esquema de comunicação por eventos para atender a um requisito essencial do \textit{framework}, a interpretação de contexto. Este esquema é denominado de \textit{publish-subscribe}, o qual muito utilizado em sistemas distribuídos.Este paradigma corresponde à uma comunicação assíncrona, que envolve o registro de interesse por parte da entidade interessada na entidade de interesse. No esquema ilustrado na Figura~\ref{fig:pubsub}, os ARs 4, 5 e 6 se subscrevem a eventos que podem ser gerados pelos ARs 1, 2 e 3 respectivamente. Como auxilio a este esquema é utilizado conceitos de Programação Orientada a Aspectos (POA), no qual é utilizado para definir pontos de aviso (\textit{advice}) para VCs alvos de interesse. Estes pontos de aviso indicam o disparo de uma notificação \textit{unicast} a todos os ARs interessados.

%descrição breve do mecanismo RPC para o SmartAndroid
Existe ainda possibilidade de comunicação direta com os ARs, o SDR pode ser utilizado para encontrar as referências de acesso direto a um em específico. Neste caso além de possuir a referência é necessário instanciar um \textit{proxy} correspondente a mesma classe do AR alvo. Com o \textit{proxy} instanciado, o mecanismo de RPC pode ser utilizado para fazer as invocações remotas das suas operações. A IPGAP utiliza a comunicação direta como meio para controlar remotamente os ARs visualizados no mapa

%A abordagem adotada no SmartAndroid difere daquelas onde 
O framework possui uma flexibilidade de comunicação que amplia o escopo de desenvolvimento de aplicações ubíquas, enquanto que muitas abordagens se restringem a comunicação baseada em eventos por ser mais econômica. 

\subsection{Modelo de Contexto} \label{subsec-contexto}
%Uma infraestrutura para construção de aplicações sensíveis ao contexto (ou aplicações ubíquas) envolve a escolha de um modelo de contexto. Em abordagens centralizadas se faz necessário a utilização de um serviço de gerenciamento de contexto, onde os dispositivos ou entitades que os representam enviam suas medições para este serviço de gerenciamento. O serviço se encarrega então de enviar as medidas para os interessados. Este é o caso, por exemplo do 

Uma infraestrutura para construção de aplicações sensíveis ao contexto (ou aplicações ubíquas) pode ter uma abordagem centralizada ou distribuída. Em abordagens centralizadas faz-se necessário a utilização de um serviço de gerenciamento de contexto, responsável por manter a informação contextual e oferecer interfaces para subscrições e consultas. Abordagens como esta correspondem à uma arquitetura do tipo \textit{blackboard} (ou quadro-negro), onde uma entidade envia uma mensagem para uma memória compartilhada entre todas as entidades, e também pode se subscrever para receber mensagens que respeitam algum padrão especificado~\cite{winograd2001architectures}. Todas as comunicações ocorrem através de um servidor centralizado e as mensagens são redirecionadas para os interessados.

Este trabalho adotou uma abordagem distribuída, onde a informação de contexto não é armazenada em um servidor centralizado, mas é mantida pelos ARs. O processo de aquisição do contexto envolve a descoberta do AR de interesse através do SDR, com a posterior subscrição do mesmo, como apresentado na Seção~\ref{subsec-comunicacao}. Assim sendo, a informação fica distribuída pelo ambiente e é informada aos interessados diretamente, enquando na abordagem centralizada são utilizados dois pulos. Embora a informação esteja distribuída em diferentes dispositivos, possivelmente com diferentes sistemas, o framework provê um nível de abstração tal que o acesso a qualquer informação é feito de maneira padronizada.

\subsubsection{Variáveis de Contexto e Operações} \label{subsubsec:cv}
As informações de contexto respectivas de cada AR são expostas através de Variáveis de Contexto (VC). Se, por exemplo, há um agente para a televisão registrado no sistema, possivelmente ele provê VCs para qual a programação que está sendo exibida, qual a programação agendada, se a própria televisão está ligada, se está gravando alguma programação, enfim, tudo que diz respeito ao estado da televisão e é efetivamente coletado.
%TODO: repito a palavra ``abordagem'' várias vezes

%As VCs possibilitam que as informações de contexto sejam acessadas sem que haja um componente centralizado armazenando-as e disponibilizando-as, %como são as abordagens que utilizam tuple space (T Space, Google Interactive Space (acho q tb usa), outras) %TODO: Falar disso tudo

O papel da Operações é expor as funcionalidades do AR, possibilitando às aplicações interagir ativamente no ambiente. Por exemplo, uma televisão integrada ao sistema pode oferecer Operações como para desligá-la, mudar de canal, gravar alguma programação, mostrar uma mensagem na tela, perguntar algo ao usuário, gerar um alerta, pausar a programação, etc.

A Figura~\ref{fig:inpt_cute} representa a subscrição às VCs ``Em uso'' do AR da cama e ``Ligado'' do AR do fogão. Na mesma figura pode-se observar a atuação no ambiente ao se utilizar as Operações ``Mostrar mensagem'' da televisão e ``Disparar'' do despertador. 

Tanto a VC como a Operação são interfaces, ou portas, do AR. Diferentes aplicações, instaladas no mesmo ambiente podem usar estas interfaces para interagir com o próprio ambiente. O SmartAndroid possui implementado uma estrutura de tipos que facilita a descoberta de ARs de interesse e possibilita o conhecimento de suas interfaces. Na implementação foi criado uma hierarquia de tipos com foco em \textit{smarthomes}, porém novos tipos podem ser criados.

As questões de segurança, inerentes ao problema, são resolvidas com duas técnicas: a própria segurança da rede e com a criação de domínios dentro de um ambiente. A segurança da rede (criptografia de pacotes em redes LAN, como WAP2 e WEP) evita que aplicações estrangeiras possam acessar os recursos de um ambiente. O domínio é uma abstração que provê restrições de acesso aos ARs que contém, o que impõe uma barreira para aplicações maliciosas, que devem requisitar permissão de acesso.

\begin{figure}[ht]
  \centering
  \includegraphics[width=.7\textwidth]{imgs/interpretador-fogao-cute.png}
  \caption{Interpretador de Regra}
  \label{fig:inpt_cute}
\end{figure}

\subsubsection{Interpretação de Contexto} \label{subsubsec-ic}
%A interpretação tem a função de aumentar a abstração em torno das VCs. 
%Geralmente aplicações necessitam de informações em um nível mais alto do que sensores proveem. Como um sensor é representado no sistema através do AR que o controla, uma outra abstração é usada para representar a informação interpretada, chamado de Interpretador de Regra (IR).

%Pode-se dizer que o primeiro nível de abstração ocorre no próprio AR. Contudo, posteriormente, pode ser necessário aumentar a abstração desta informação para um nível acima, o que pode ser feito inclusive em tempo de execução.

%A interpretação de contexto possibilita que diversas informações de contexto, relacionadas através de uma expressão lógica, sejam manipuladas em uma entidade em separado, provendo separação de interesses. O interessado poderá referenciar apenas uma entidade, ao invés de várias, a fim de se obter a informação interpretada.

Como foi representado na Figura~\ref{fig:cmd-intp}, o IR se posiciona entre os ARs e a aplicação, aumentando assim o nível de abstração.


%Figura: Arquitetura em camadas: desde os recursos até a aplicação, passando pelo IC

%\subsubsection{Criação de Interpretador de Contexto}
%Figura: Figura que demonstre essa rotina.

%\subsubsection{Interpretador de Contexto em Funcionamento}
% Figura: Figura que permita mostrar o funcionamento passo-a-passo do IC

%\subsubsection{Temporização}
%Figura: Figura equivalente à anterior, mas mostrando com o temporizador.

%\subsection{Interface Gráfica de Composição de Regras}
%Se tiver alguma coisa da GUI pronta até lá, colocar uma figura aqui.
%referenciar no paper do david


%%%%%%%%%%%%%%%%
%  AVALIACAO   %
%%%%%%%%%%%%%%%%
\section{Avaliação} \label{sec-av}
%falar sobre o SmartAndroid
Para consolidar a proposta do \textit{framework} foi desenvolvido um projeto para a plataforma \textit{Android} denominado \textit{SmartAndroid}. Este projeto se beneficia da acessibilidade da tecnologia e de sua portabilidade a diversos tipos de dispositivos embarcados. Isto possibilita que o \textit{framework} seja mais abrangente e possibilite o desenvolvimento sistemas de aplicações ubíquas mais elaborados ao longo do tempo. 

%falar sobre o que foi desenvolvido para avaliar a qualidade do framework (jogo da velha e aplicação de economia de luz)
A qualidade do \textit{framework} foi avaliado em duas fases. Primeiro foi avaliado o fator de transparência de comunicação na construção de aplicações ubíquas. Esta avaliação ocorre através do processo de transformação de uma aplicação estritamente local \textit{Android} em uma aplicação ubíqua através do \textit{SmartAndroid}. Depois é avaliada a transparência no desenvolvimento de aplicações sensíveis ao contexto e manipulação das informações de contexto promovida pelo modelo de regras.

\subsubsection{Prova de Eficiência Conceitual}

\begin{figure}[ht]
  \centering
  \includegraphics[height=.8\textwidth]{imgs/app/tictactoe.PNG}
  \caption{Comparação entre os modelos das aplicações Android e SmartAndroid}
  \label{fig:tictactoe}
\end{figure}

%descrição da prova de conceito jogo da velha (figura tictactoe)
Para a primeira avaliação utilizou-se a aplicação do jogo da velha (tic tac toe) como base. Nesta aplicação em sua versão \textit{Android}, os jogadores interagem através de uma mesma tela de dispositivo (\textit{tablet} ou \textit{smartphone}). Na sua versão desenvolvida com o SmartAndroid os jogadores interagem sobre um mesmo tabuleiro em dispositivos diferentes. A Figura~\ref{fig:tictactoe} ilustra o modelo de aplicação das duas versões. A versão original possui o componente da GUI ("Tic Tac Toe"), motor do jogo ("Game"), a estrutura do tabuleiro ("Board") e a identidade dos jogadores ("Player") que pode ser do tipo "X" ou "O". O motor do jogo atualiza a estrutura da borda ("update"), a qual atualiza periodicamente a GUI ("show"). O tipo do jogador é verificado para indicar qual simbolo é marcado no tabuleiro ("X" ou "O") ("set moves"). 

%descrição do processo de transformação
Na versão \textit{SmartAndroid} é inserido um AR do jogo para interação remota ("Game Agent"), o qual esta associado a um motor de jogo de um dispositivo de um dos jogadores (Jogador "X"). O AR do jogo intercepta a atualização deste motor ("set moves") e encaminha para o AR do outro jogador (Jogador "O"). Este AR do Jogador "O" atualiza o tabuleiro com a jogada do jogador "X" ("update" do "Game Agent"). Para evitar que um jogador jogue na vez do outro, por exemplo o Jogador "X" jogue no turno do Jogador "O" é verificada a identidade do jogador da vez como jogador que tenta a jogada ("check permission"). Na Figura~\ref{fig:tictactoe} as ligações unidirecionais em amarelo indicam as alterações realizadas no processo transformação. A parte de inicialização do jogo foi modificada para registrar o AR do jogo e este registrar interesse em ARs participantes do jogo já registrados anteriormente para receber notificação de novos movimentos. Através do SDR é verificada a existência deste tipo de AR. Caso não haja nenhum então o AR passa a representar o Jogador "X", caso haja um apenas então o AR representa o Jogador "O", caso haja mais de um, o AR é apenas observador do jogo.

%avaliação jogo da velha
Foi observado que o uso de elementos do suporte como SDR e SRR e do esquema de \textit{publish-subscribe} facilitou o processo de transformação da aplicação. Na etapa de inicialização do jogo, o SRR foi utilizado para registrar o AR do jogo e o SDR foi utilizado para descobri-los e o esquema de \textit{publish-subscribe} foi utilizada para cada jogador registrar interesse nos movimentos do respectivo adversário. Após isso, a aplicação segue seu fluxo de execução padrão com o os procedimentos adicionais destacados em amarelo na Figura~\ref{fig:tictactoe}. Portanto, após a etapa de inicialização nenhuma alteração no nível de comunicação ou contexto foi necessária, todas as alterações posteriores ocorreram para promover a interação com o AR do jogo local ao dispositivo. Logo, podemos comprovar que o uso de AR tornou transparente a programação da aplicação ubíqua.

\subsubsection{Aplicação de Controle de Iluminação Residencial}
%descrição da aplicação de economia de energia
Para avaliar o uso do serviço de localização e do modelo de regras é proposto um sistema de controle de iluminação para \textit{smarthomes} (CI-Smart). O intuito do CI-Smart é promover a economia de consumo de energia reduzindo gastos com iluminação. O seguinte cenário é criado para construir uma aplicação: cada cômodo (sala, quarto, escritório, etc) do domínio (casa, escola, etc) tem um AR que controla o estado de uma lampada (ligado/desligado) e outro que sente a presença de pessoas no ambiente (ocupado/livre).... %TODO: (douglas) em desenvolvimento


\begin{figure}[ht]
  \centering
  \includegraphics[height=.4\textwidth]{imgs/ipgap/app_controle_lamps.png}
  \caption{Aplicação de Controle de Iluminação na IPGAP}
  \label{fig:app_lamps}
\end{figure}


%%%%%%%%%%%%%%%%
% RELACIONADOS %
%%%%%%%%%%%%%%%%
\section{Trabalhos Relacionados} \label{sec-trab_rel}
%Diversos trabalhos vem sendo desenvolvidos nas áreas de Computação Ubíqua ou Pervasiva, Computação Sensível ao Contexto, 
Diversos trabalhos vem sendo desenvolvidos nas áreas de Computação Ubíqua e Computação Sensível ao Contexto aplicados a ambientes inteligentes. Alguns abordam a arquitetura do \textit{framework} \cite{helal2005gator} \cite{ranganathan2005olympus}, outros enfatizam aspectos de comunicação  \cite{villanueva2009framework} \cite{santi2011jaca}, e há aqueles que focam em técnicas de Computação Sensível ao Contexto \cite{liu2003dios++} \cite{Chen2002} \cite{sudha2007ubiquitous} \cite{lee2012mobicon}. 


%trabalhos relacionados a middlewares e frameworks
%\cite{helal2005gator}
Em \cite{helal2005gator} é proposta uma arquitetura de camadas. Dentre estas há a camada física com seus sensores, atuadores e outros dispositivos. Logo acima encontra-se a camada de plataforma de sensores onde ocorre a homogenização dos recursos físicos. A camada de serviços possui a representação dos recursos (serviços). Em analogia com nossa proposta, os serviços podem ser vistos como ARs, existem os mais básicos que representam diretamente os recursos e os mais complexos que é composto de vários serviços. As camadas de conhecimento e de contexto manipulam esta camada de serviços, a camada de conhecimento além de possuir elementos com funções similares ao do SGAR, na qual aplica um motor de raciocínio que permite avaliar se alguns serviços complexos estão disponíveis no ambiente. E a camada de contexto tem função similar ao nosso modelo de regras só que atuando em uma granularidade mais grossa. O gerenciamento destes serviços ocorre através dos elementos da camada de aplicações (aplicações ubíquas). A conclusão é que o nosso \textit{framework} possui uma estrutura semelhante, porém há neste trabalho uma série de mecanismos não considerados em \cite{helal2005gator} para a construção e instalação de novas aplicações. Além disso o \textit{framework} não se restringe a se aplicar apenas a um  ambiente do tipo \textit{smarthome}.

Em \cite{ranganathan2005olympus} é proposto um conjunto de operações de alto nível para ambientes inteligentes (espaços ativos). As operações básicas são semelhantes as funções de um sistema operacional, só que ao invés de manipular recursos deste tipo sistema, entidades do ambiente são manipuladas. Em nosso \textit{framework} há apenas funções de manipulação que seguem o paradigma CRUD \cite{wikiCRUD}. As outras funções como parar, iniciar, suspender, reiniciar são definidas por cada AR e aplicação ubíqua do sistema, permitindo uma distribuição do controle de serviços do ambiente.

Boa parte dos \textit{frameworks} propostos relutam em levantar pontos sobre a sobrecarga de comunicação decorrente em sistemas ubíquos. O artigo \cite{villanueva2009framework} é uma proposta com abordagem distribuída para a parte de suporte (SGAR). O serviço de descoberta ocorre através de um protocolo de comunicação do tipo \textit{multicast}. O módulo de descoberta possui portas especializadas para escuta, busca e manipulação em cada componente do sistema. Em analogia com a nossa proposta de registro de recursos, pode ser estipulado registro local de recursos através da porta de escuta, tendo assim cada componente um repositório local de recursos. Porém o custo de espaço desta abordagem é muito alto devido a ocorrência de replicação de dados sobre o ambiente, e acaba ocasionando sobrecarga no consumo de energia devido a comunicação excessiva característica do padrão \textit{multicast}.

%\cite{santi2011jaca}
O JaCa-Android \cite{santi2011jaca} é uma plataforma baseada em agentes para lidar com concorrência, eventos assíncronos, gerenciamento de recursos e sensibilidade ao contexto para possibilitar a construção de aplicações de manipulação de eventos. Para seu desenvolvimento são utilizadas as ferramentas de programação orientada a agentes. Os componentes do \textit{framework} do Android são  mapeados como artefatos para serem manipulados pela aplicação baseada em eventos definida utilizando a plataforma JaCa-Android. Este trabalho traz um modo de captura de mudança de estado em recursos através de eventos, em nossa proposta esta mesma abordagem é utilizada para interessados em informações de um agente de  recurso específico.
%essencialmente focamos em sistemas distribuídos, <não vamos falar dos sistemas 
%falar dos sistemas q tb tem uma arquitetura em camadas, mas nas diferenças entre o deles e o nosso


%~\cite{liu2003dios++}
%\cite{Chen2002} \cite{sudha2007ubiquitous} \cite{lee2012mobicon}


%%%%%%%%%%%%%
% CONCLUSÃO %
%%%%%%%%%%%%%
\section{Conclusão e Trabalhos Futuros} \label{sec-conclusao}



%\cite{boulic:91}
\nocite{abowd1999towards}
\nocite{Brandle2007}
\nocite{Cardoso2006}
\nocite{Chen2002}
\nocite{chen2010context}
\nocite{Dey2001}
\nocite{lee2012mobicon}
\nocite{liu2003dios++}
\nocite{sudha2007ubiquitous}
\nocite{wang2005towards}


\bibliographystyle{sbc}
\bibliography{references}

\end{document}
