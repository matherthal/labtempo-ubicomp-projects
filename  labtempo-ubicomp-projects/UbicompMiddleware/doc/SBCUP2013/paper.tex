\documentclass[12pt]{article}

\usepackage{sbc-template}

\usepackage{graphicx,url}
\usepackage[space]{grffile}

\usepackage[brazil]{babel}   
\usepackage[latin1]{inputenc}  

\usepackage{listings}
\lstset{numbers=left,
stepnumber=1,
firstnumber=1,
numberstyle=\footnotesize,
extendedchars=true,
breaklines=true,
frame=tb,
basicstyle=\footnotesize,
stringstyle=\ttfamily,
showstringspaces=false
}
\renewcommand{\lstlistingname}{Código}
\renewcommand{\lstlistlistingname}{Lista de Listagens}
\providecommand*{\lstnumberautorefname}{line} 
     
\sloppy

\title{Interpretação de Contexto em Ambientes Inteligentes}
%acho q \\ pula linha
\author{Matheus Erthal\inst{1}, David Barreto\inst{1}, Douglas Mareli\inst{1}, Orlando Loques\inst{1}}


\address{Instituto de Computação -- Universidade Federal Fluminense (UFF)\\
  Niterói -- RJ -- Brasil
% \nextinstitute
%   Department of Computer Science -- University of Durham\\
%   Durham, U.K.
% \nextinstitute
%   Departamento de Sistemas e Computação\\
%   Universidade Regional de Blumenal (FURB) -- Blumenau, SC -- Brazil
  \email{\{merthal,dbarreto,dmareli,loques\}@ic.uff.br}
}

\begin{document} 

\maketitle

%_________________________________________________________________________________________%

%%%%%%%%%%%%%%
%  RESUMOS   %
%%%%%%%%%%%%%%

\begin{resumo} 
%Muito mal escrito
% Aplicações sensíveis ao contexto vêm adquirindo cada vez mais visibilidade no atual cenário de desenvolvimento de aplicações. São tratadas, neste artigo, questões relacionadas à representação das informações de contexto, à sua distribuição em ambientes inteligentes e à interpretação da informação de contexto, identificadas como problemas de primeira necessidade. A criação de regras de contexto possibilita que o ambiente interaja ativamente com pessoas ao prover serviços baseados em suas necessidades ou desejos. As regras são ligadas aos agentes provedores de contexto através de um mecanismo de subscrição, e reagem através do mesmo mecanismo, notificando os atuadores. Na implementação da proposta será também incluída uma interface gráfica que permite a criação de regras de contexto em alto nível, possibilitando que usuários finais definam suas preferências no ambiente de maneira simples.

A sensibilidade ao contexto vem adquirindo cada vez mais visibilidade no atual cenário de desenvolvimento de aplicações. Este trabalho propõe nesta área uma nova solução para a representação, distribuição e interpretação de informações de contexto, possibilitando a construção de aplicações para ambientes inteligentes. Através da infraestrutura descrita neste artigo, os recursos do ambiente são expostos em um nível mais alto, tornando a criação de regras de contexto mais simples e dinâmica para desenvolvedores; e através de uma interface gráfica, usuários finais podem facilmente criar e personalizar regras no ambiente.
\end{resumo}

%_________________________________________________________________________________________%

\begin{abstract}
% [ OPÇÃO 1]
% Recently, context awareness is reaching increasingly visibility in the current applications development scenario. To address this problem, this work proposes a new solution for representing, distributing and interpreting context informations, thus allowing the construction of applications for intelligent ambients. Through the infrastructure described in this paper, the ambient resources are exposed in a higher level, leading to a simpler and more dynamic creation of context rules; and through a graphical interface, end users are able to easily create and customize rules in the ambient.

% [OPÇÃO 2]
Recently, context awareness is reaching increasingly visibility in the current applications development scenario. To address this problem, this work proposes a new solution for representing, distributing and interpreting context informations, thus allowing the construction of applications for intelligent ambients. The infrastructure described in this paper exposes the ambient in a higher level, leading to a simpler and more dynamic creation of context rules; and by means of a graphical interface, end users are able to easily create and customize rules in the ambient.

%FIXME WORK OR PAPER OR ARTICLE?
\end{abstract}


%_________________________________________________________________________________________%

%%%%%%%%%%%%%%
% INTRODUÇÃO %
%%%%%%%%%%%%%%
\section{Introdução}
%[ OPÇÃO DE 1o PARAGRAFO ]
% Imagine um ambiente onde usuários interagem com computadores sem ações explícitas. Por meio de sensores são coletadas informações de contexto sobre as pessoas e o meio, a fim de se identificar a necessidade das pessoas e prover serviços, que vão desde ações para prover conforto até serviços de cuidados médicos. Mark Weiser cunhou o termo ``computação ubíqua'' na década de 1990 para designar tais sistemas~\cite{weiser1991computer}.

%[ OPÇÃO DE 1o PARAGRAFO ]
Os recentes avanços no desenvolvimento da computação móvel -- em termos de custo, miniaturização, energia, e outros -- têm indicado um cenário favorável ao crescimento da aplicação da computação ubíqua. Este termo foi criado por Weiser na década de 1990~\cite{weiser1991computer} para descrever os sistemas que permeiam o ambiente, identificando as necessidades dos usuários e oferecendo serviços. A partir dessas ideias surgiu o conceito de ambientes inteligentes (AmbI), onde uma variedade de dispositivos está disponível e conectada em rede, fornecendo informações relevantes sobre o ambiente para aplicações e usuários, e atuando no ambiente (e.g., \textit{smart homes}).

% [ DIFICULDADES: CARO DESENVOLVER? DIFÍCIL? ]
Diversos desafios surgem durante a criação de uma aplicação ubíqua do ponto de vista do desenvolvedor, e durante a configuração do ambiente, do ponto de vista do usuário, que acabam por impactar na aceitação. Como identificado por \cite{araujo2003}, a heterogeneidade dos dispositivos envolvidos dificulta a criação de aplicações ubíquas no que concerne à comunicação, assim como a quantidade e a variedade de informações de contexto e serviços é um desafio à interatividade das aplicações. Para os usuários, estudos, como \cite{brush2011home}, ajudam a explicar a diferença entre as visões de longa data da computação ubíqua e a realidade. Levantando questões referentes à capacidade de personalização do ambiente, confiabilidade, a complexidade das interfaces de usuário, dentre outras.

% [ DIFICULDADES: CARO DESENVOLVER? DIFÍCIL? - opcao 2]
% Estudos, como \cite{brush2011home}, ajudam a explicar a diferença entre as visões de longa data da computação ubíqua e a realidade, para os usuários. Uma das barreiras é a baixa capacidade de gerenciamento, que traz desafios, como o suporte à personalização, confiabilidade, e a complexidade das interfaces de usuário. Do ponto de vista dos desenvolvedores, a heterogeneidade dos dispositivos envolvidos dificulta a criação de aplicações ubíquas no que concerne à comunicação, assim como a quantidade e a variedade de informações de contexto e serviços é um desafio à interatividade das aplicações; como identificado por \cite{araujo2003}.
%Barreiras para esta adoção são: o alto preço, inflexibilidade, baixa capacidade de gerenciamento e dificuldade em se obter segurança.

% [ FALAR DE TRABALHOS RELACIONADOS BREVEMENTE ]
% ??? MANTER ???

% [ PROPOSTA ]
Este trabalho complementa o \textit{framework} proposto em~\cite{mareli2013}, contudo, focando na interpretação do contexto. A solução proposta engloba a representação da informação contextual, a distribuição desta informação no AmbI, e a interpretação do contexto baseado em regras. Adicionalmente é proposta uma interface para a criação das regras de contexto integrada à Interface de Prototipagem e Gerenciamento de Aplicações Pervasivas (IPGAP)~\cite{barreto2013ipgap}, voltada à visualização e ao teste de aplicações ubíquas, mesclando componentes reais e virtuais.
%TODO: QUE TAL DAR DE CARA O EXEMPLO DO FOGÃO! Assim ajudaria a identificar os desafios!

%[ FALAR DO SMARTANDROID ]
Os conceitos apresentados neste trabalho foram concretizados sobre uma plataforma denominada \textit{SmartAndroid}\footnote{www.tempo.uff.br/smartandroid}, desenvolvida no contexto do projeto. A implementação deste projeto tem viabilizado a construção de casos de uso que evidenciam a efetividade da abordagem para prover sensibilidade ao contexto a novas apliações.
%TODO: orl - só falei em casos de uso - e as questões de competência? é bom citar

%[ RESUMO DAS SEÇÕES ]
O artigo está assim organizado: a Seção~\ref{sec-concept} apresenta os conceitos de suporte que orientam o desenvolvimento deste trabalho, incluindo a apresentação do \textit{framework}, que este trabalho complementa; a Seção~\ref{sec-proposta} apresenta uma nova abordagem para a representação, distribuição e interpretação de informações de contexto; na Seção~\ref{sec-implement} é apresentado o SmartAndroid, uma implementação dos conceitos propostos; a Seção~\ref{sec-trab_rel} apresenta uma comparação com trabalhos relacionados; e a Seção~\ref{sec-conclusao} apresenta as conclusões e trabalhos futuros.


%_________________________________________________________________________________________%

%%%%%%%%%%%%%%%%
%  FRAMEWORK   %
%%%%%%%%%%%%%%%%
\section{Conceitos de Suporte} \label{sec-concept}
% [ ABSTRAÇÕES DO FRAMEWORK ]
%FIXME: 1a frase igual na intro. Tá feio
Este trabalho complementa o \textit{framework} proposto em \cite{mareli2013}, que provê facilidades e padrões de programação tipicamente requeridos em aplicações sensíveis ao contexto focadas em AmbI, definidas na Seção~\ref{subsec-context}. Dentre as facilidades está a capacidade de abstrair detalhes das partes da aplicação que envolve a comunicação, a aquisição de contexto e a localização de recursos. Como abstração aos recursos são utilizados componentes denominados Agentes de Recursos (AR), definidos na Seção~\ref{subsubsec-ar}. O gerenciamento dos ARs -- incluindo o registro dos mesmos, a consulta, a localização e o gerenciamento do ciclo de vida -- é descrito na Seção~\ref{subsubsec-sgar}.

\subsection{Sensibilidade ao Contexto} \label{subsec-context}
%[ INTRODUZIR O CONCEITO DE CONTEXTO ]
O contexto exerce um papel de fundamental importância na Computação Ubíqua. Sintetizando propostas anteriores, Dey e Abowd \cite{Dey2001} definiram que contexto é qualquer informação relevante usada para caracterizar a situação de entidades, especificamente: pessoas, lugares e coisas. No AmbI, ``Lugares'' são os cômodos, os andares de uma edificação, ou espaços em geral que possibilitam a localização de outras entidades; ``Pessoas'' são indivíduos que povoam o ambiente e interagem com o mesmo; e ``Coisas'' são representações virtuais de objetos físicos ou componentes de software.

% [ EXPLICAÇÃO DE SENSIBILIDADE AO CONTEXTO ]
A sensibilidade ao contexto está em se determinar o que o usuário está tentando realizar a partir da aquisição de contexto. Por exemplo, se uma pessoa sai de casa e deixa a torneira aberta, provavelmente a tenha esquecido nesse estado. Por exemplo, se um idoso, que mora sozinho, liga o fogão e vai dormir, provavelmente o esqueceu ligado. Neste caso, um sistema sensível ao contexto faz o que qualquer pessoa faria se detectasse esta situação (i.e., acordaria o idoso e/ou desligaria o fogão). A aquisição do contexto de forma automatizada contribui para a construção de aplicações para AmbI que, de outra maneira, seriam inviáveis, por exigir a entrada de dados ou comandos diretamente por parte dos usuários. Este trabalho oferece um suporte para a declaração e consulta das informações de contexto, assim como para a interpretação destas informações, possibilitando a construção de regras de contexto para atuar no AmbI.

\subsection{Agentes de Recurso} \label{subsubsec-ar}
% [ ENCAPSULAMENTO DE RECURSOS ATRAVÉS DO AR ]
Sensores, atuadores, dispositivos e eletrodomésticos inteligentes, além de módulos de \mbox{\textit{software}} que forneçam algum serviço para o ambiente, são definidos como \textit{recursos}. Estes são encapsulados em entidades chamadas Agentes de Recurso (AR), que podem ser compreendidos como elementos que expõem informações dos recursos juntamente com sua interface, de forma que outras entidades possam acessá-las de maneira uniforme diminuindo a complexidade de integração. Por exemplo, os detalhes da coleta de dados de um sensor de temperatura seriam conhecidos apenas pelo seu AR, que se encarrega de fornecer uma interface simples para outros componentes do sistema.

% [ ESTRUTURA DO AR E RESOLUÇÃO DE HETEROGENEIDADE ]
Proposto inicialmente em \cite{cardoso2006} como uma entidade de coleta de informações de contexto, a estrutura do AR permite resolver o desafio da heterogeneidade de dispositivos abordado em \cite{mareli2013}. A estrutura geral do AR, possui, dentre outros atributos, uma hierarquia de tipos que é composta por uma sequência de classes, tendo sido inspirada na ontologia descrita em~\cite{ranganathan2005olympus} para classificar entidades (como os ARs). A hierarquia possibilita a consulta e instanciação de ARs a partir de propriedades associadas a uma classe específica. 

%[ DESCREVER FIGURA REALÇANDO RELACIONAMENTO DOS ARS COM RECURSOS ]
A Figura~\ref{fig:arquitetura} representa uma arquitetura em camadas para o \textit{framework}. Na camada ``Recursos'' encontram-se os dispositivos, ou módulos de software, que efetivamente interagem com os usuários (e.g., cama, fogão, TV). Na camada do ``Middleware'' encontram-se os ARs (e.g., Agente da Cama, Agente do Fogao, Agente da TV), que representam os recursos e expõem suas interfaces de maneira uniforme para as aplicações ou outros ARs. Encontra-se também na camada intermediária o Suporte ao Gerenciamento de Recursos (Seção~\ref{subsubsec-sgar}), e os ARs interpretadores e atuadores (Seção~\ref{subsec-ic}), definidos no nível da aplicação, mas com o suporte da camada intermediária. Na camada ``Aplicações'' encontram-se aplicações desenvolvidas por terceiros (Seção~\ref{sec-implement}) que usufruem de maneira segura das abstrações providas pela camada intermediária.

\begin{figure}[ht]
  \centering
  \includegraphics[height= .4\textwidth]{imgs/framework/arquiteturaGeral5.1.png}
  \caption{Arquitetura do \textit{Framework}}
  \label{fig:arquitetura}
\end{figure}


\subsection{Infraestrutura de Comunicação e Gerenciamento} \label{subsec-infra}
%[ INTRODUZIR O SGAR E RELACIONÁ-LO COM O FRAMEWORK -- APONTÁ-LO NA FIGURA, OU TALVEZ NO PARÁGRAFO ABAIXO ]
O objetivo do \textit{framework} é fornecer suporte à programação, teste e execução de aplicações, permitindo lidar de forma consistente com sistemas de grande complexidade. O AR é a unidade básica de modularização do sistema, sendo gerenciados pelo Suporte ao Gerenciamento de Agentes de Recursos (SGAR) e beneficiados pelos mecanismos de comunicação apresentados na Seção~\ref{subsubsec-comm}. 


\subsubsection{Comunicação} \label{subsubsec-comm}
%TODO: REMOVER ESTA SEÇÃO PARA ECONOMIA
% [ RPC E PUBSUB ]
De modo a atender requisitos tópicos de ambientes distribuídos, o \textit{framework} dispõe de dois mecanismos de comunicação: a invocação remota de procedimentos (\textit{Remote Procedure Call} -- RPC), para possibilitar uma comunicação síncrona, e a comunicação por eventos seguindo o paradigma \textit{publish-subscribe} \cite{eugster2003many}, para comunicação assíncrona. 

% [ SEGURANÇA ]
Como suporte, a comunicação no \textit{framework} requisita uma infraestrutura básica de rede. Por conveniência, foi adotado Wi-Fi, que garante o mínimo de segurança contra acesso de agentes externos à rede do ambiente e agrega benefícios de mecanismos de criptografia, como a WPA.


\subsubsection{Suporte ao Gerenciamento de Recursos} \label{subsubsec-sgar}
% [ EXPLICAR SGAR EM ALTO NÍVEL ]
O SGAR é o serviço responsável por gerenciar o conjunto de ARs no AmbI. O controle de registro e descoberta de ARs segue a ideia geral sobre serviços que manipulam recursos apresentada em \cite{cardoso2006}. 

%[ DESCREVER OS SERVIÇOS DO SGAR ]
A Figura~\ref{fig:arquitetura} apresenta o SGAR localizado na camada intermediária e, internamente, apresenta o Banco de Dados (BD), que corresponde ao Repositório de Recursos. Três componentes, ou serviços básicos, compõem o SGAR: o Serviço de Registro de Recurso (SRR), o Serviço de Descoberta de Recursos (SDR) e o Serviço de Localização de Recursos (SLR). O SRR é utilizado para registrar ou remover ARs no ambiente, o SDR localiza recursos para permitir o acesso remoto e o SLR os localizam através de posições físicas e  indica os recursos mais próximos~\cite{mareli2013}. 

%%%%%%%%%%%%%%
%  PROPOSTA  %
%%%%%%%%%%%%%%
\section{Proposta} \label{sec-proposta}
% [ EXPICAR O QUE É A PROPOSTA E APONTAR PRAS SUBSEÇÕES EM SEQUENCIA ]
A proposta deste trabalho é oferecer uma solução para a representação da informação de contexto e para a sua distribuição através do modelo de contexto apresentado na Seção~\ref{subsec-cv}. A partir do modelo de contexto é suportada a interpretação de contexto, apresentada na Seção~\ref{subsec-ic}.

\subsection{Variáveis de Contexto e Operações} \label{subsec-cv}
%[ EXPLICAR VC ]
As informações de contexto respectivas de cada AR são expostas através de Variáveis de Contexto (VC). Por exemplo, um agente para uma \textit{smart-tv} pode prover VCs para: qual a programação que está sendo exibida, qual a programação agendada, se a própria televisão está ligada, se está gravando alguma programação, e outras. Em outros termos, tudo o que diz respeito ao estado da televisão e que pode efetivamente ser coletado.

%[ EXPLICAR OPERAÇÕES ]
Uma Operação (OP) tem o papel de expor uma funcionalidade (ou serviço) do AR, possibilitando às aplicações interagirem ativamente no ambiente. Por exemplo, uma televisão integrada ao sistema pode oferecer OPs para desligá-la, mudar de canal, gravar alguma programação, mostrar uma mensagem na tela, perguntar algo ao usuário, gerar um alerta, pausar a programação, etc.

%[ FALAR DE VC E OP COMO INTERFACES E FALAR DA FIGURA ]
Tanto VCs como OPs definem interfaces, ou portas do AR. Diferentes aplicações, instaladas no mesmo ambiente podem usar estas interfaces para interagir com o próprio ambiente. A Figura~\ref{fig:inpt_cute} representa a subscrição às VCs ``Em uso'' do AR da cama e ``Ligado'' do AR do fogão. Na mesma figura pode-se observar a atuação no ambiente ao se utilizar as OPs ``Mostrar mensagem'' da televisão e ``Disparar'' do despertador. O Interpretador e o Atuador também representados na figura serão descritos na Seção~\ref{subsec-ic}.

\begin{figure}[ht]
  \centering
  \includegraphics[width=\textwidth]{imgs/ic/interpretador-fogao-cute_v2.png}
  \caption{Interpretação de Contexto}
  \label{fig:inpt_cute}
\end{figure}


%_________________________________________________________________________________________%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  INTERPRETAÇÃO DE CONTEXTO   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Interpretação de Contexto} \label{subsec-ic}
%[ FALAR DE MANEIRA GERAL DA INTERPRETAÇÃO DE CONTEXTO, DO IC E DO ATUADOR ]
A interpretação de contexto tem a função de agregar informações de contexto provenientes de diferentes fontes, considerando também a passagem de tempo, e avaliá-las segundo alguma lógica específica. O suporte à interpretação de contexto pelo \mbox{\textit{framework}} possibilita uma separação de interesses, onde os desenvolvedores abstraem a implementação de regras de contexto e focam na lógica da aplicação.

% [ DEFINIÇÃO DOS ATUADORES E AÇÕES ]
Em nossa proposta, como opção básica, a interpretação do contexto é desempenhada por entidades chamadas \mbox{Interpretadores} de Contexto (IC), que avaliam essas informações e notificam agentes atuadores interessados. Atuadores são quaisquer ARs que se subscrevem em ICs para desempenhar ações dado a ocorrência do evento de regra validada. As ações podem ser tanto no nível de software (e.g., guardar no histórico, enviar para um servidor remoto) quanto no nível do ambiente, ao se chamar OPs de outros ARs (e.g., mostrar uma mensagem na televisão, disparar o despertador, mudar a temperatura do ar-condicionado). 

% [ ELOGIO À LIBERDADE DE LIGAR MAIS ATUADORES ]
As ligações entre ICs e Atuadores podem ser feitas e desfeitas dinamicamente, uma vez que são baseadas no mecanismo de subscrição de ARs. Um usuário, que esteja personalizando o sistema, ao criar novas regras de contexto, tem a possibilidade de ligar ao IC não só um atuador que esteja criando, mas outros que já existem. Um exemplo de uso será visto na Seção~\ref{sec-implement}.

% [ SEPARAÇÃO DE INTERESSES ATRAVÉS DO IC ] 
A interpretação de contexto possibilita que diversas informações de contexto, relacionadas através de uma expressão lógica, sejam manipuladas em uma entidade em separado, provendo separação de interesses. O interessado poderá referenciar apenas uma entidade, ao invés de várias, a fim de se obter a informação interpretada. O termo ``regra de contexto'' também usado neste texto, se refere ao relacionamento IC-Atuador(es), que implementa propriamente uma regra para o AmbI.

% [ falar do IC em funcionamento ]
Considere a seguinte regra simples: se uma pessoa (que mora sozinha) ligou o fogão, se deitou na cama, e passaram-se 15 minutos, então dispare o alarme do despertador e mostre na televisão a mensagem ``O fogão foi esquecido ligado!''. Este exemplo poderia ser implementando no sistema como representado na Figura~\ref{fig:inpt_cute}. O IC recebe notificações da TV e do fogão com valores atualizados das VCs ``ligado'' e ``em uso'', \mbox{respectivamente}, e resolve internamente a temporização monitorada destas VCs. Uma vez que o IC tenha avaliado a regra como verdadeira durante o tempo de 15 minutos (previamente declarado), ele notifica o atuador ``Lembrar usuário''. O atuador, por sua vez, invoca as OPs ``Mostrar mensagem'' da TV e ``Disparar'' do despertador.

% [ ESTRUTURA INTERNA DO IC E ENCAPSULAMENTO POR AR ]
O IC é encapsulado em um AR, assim estendendo suas funcionalidades. Sua criação ocorre quando é definida uma expressão lógica -- segundo um padrão próprio adotado em arquivos tipo JSON --, no objeto do IC recém instanciado e um \textit{parser} constrói uma estrutura lógica interna, como mostrado na Figura~\ref{fig:inpt_arq}. A estrutura lógica abrigada pelo IC, contém uma estrutura em árvore que representa a expressão e contém não só a lógica entre as VCs das condições, como também valores atualizados das mesmas. Enquanto em funcionamento, o IC recebe atualizações das VCs, tratando-as em seguida para atualizar sua estrutura lógica. O módulo de avaliação é notificado de mudanças da estrutura lógica e avalia se a expressão se tornou verdadeira ou falsa. Se a expressão alcançou um estado verdadeiro, ou válido, considerando as possíveis temporizações, notifica os atuadores. 

\begin{figure}[ht]
  \centering
  \includegraphics[height=.4\textwidth]{imgs/ic/interpretador_arquiteturav4_bigger.png}
  \caption{Estrutura do Interpretador de Contexto}
  \label{fig:inpt_arq}
\end{figure}

% [ MOTOR DE REGRAS ]
O \textit{framework} é suficientemente flexível possibilitar a interpretação de contexto a partir dos ICs, assim como a partir da agregação de um motor de regras (e.g., Jess, \mbox{Drools}, CLIPS, um motor proprietário). Um motor de regras é uma ferramenta geralmente centralizada, que recebe informações de contexto de diversas fontes e processa regras previamente inseridas, onde é comum usar um algorítmo como o RETE~\cite{forgy1982rete}, que processa regras construidas apenas com cláusula ``E'' eficientemente. Assim sendo, utilizando o \textit{framework}, é também possível que sejam feitas as ligações entre entre as VCs com o motor de regras, se for de interesse.

\subsubsection{Temporização} \label{subsubsec-timer}
% [ COMO É A TEMPORIZAÇÃO NO IC ]
A temporização em um IC é definida ao se associar temporizadores (``\textit{timers}'') à uma condição expressão da regra (ou subexpressões). Os temporizadores podem ser tanto relativos (e.g., fogão ligado e pessoa deitada na cama por 15min) quanto absolutos (e.g., ar-condicionado ligado às 18:00).

% [ INTERRUPÇÃO DE TEMPORIZADOR E AVALIAÇÃO DE REGRAS TEMPORIZADAS ]
Durante a avaliação, se a expressão ou uma subexpressão que possuir um temporizador associado chegar em um estado válido, o temporizador é inicializado. Se, chegando ao final, o temporizador retorna, e não houver mais temporizadores a se esperar, os atuadores são notificados. Se, durante uma avaliação, a expressão ou subexpressão se torna invalida, então os temporizadores associados são interrompidos.

\subsubsection{Prototipagem e Simulação} \label{subsubsec-ipgap}
%[ IPGAP MOTIVAÇÃO ]
Uma das causas da escassez de aplicações ubíquas no mercado, em comparação ao avanço no desenvolvimento de aplicações \textit{mobile}, é o alto custo de desenvolvimento demandado por elas devido a questões como a falta de ferramentas adequadas para a criação e integração dessas aplicações, e a dificuldade para depurá-las~\cite{weis2007rapid}. Para resolver esses problemas, é proposto em~\cite{barreto2013ipgap} uma ferramenta de suporte à construção de protótipos de aplicações pervasivas chamada IPGAP (Interface de Prototipagem e Gerenciamento de Aplicações Pervasivas), que fornece ao desenvolvedor um ambiente de testes para suas aplicações de maneira rápida e com baixo custo. 

%[ FALAR DA AJUDA DA IPGAP PARA TESTAR REGRAS EM FUNCIONAMENTO ANTES DA IMPLANTAÇÃO -- INCLUINDO A SIMULAÇÃO E EMULAÇÃO ]
A Figura~\ref{fig:ipgap}~(a) ilustra a IPGAP executando em um \mbox{\textit{tablet}} e \mbox{\textit{smartphones}} emulando recursos como TV, lâmpada e termômetro. O ambiente é mapeamento pela IPGAP, possibilitando a visualização e controle dos recursos representados. Outros recursos, além dos da figura, podem ser simulados virtualmente por componentes de software, de tal maneira que, a interface pode exibir conjuntamente recursos reais e simulados, criando assim um ambiente híbrido. A Figura~\ref{fig:ipgap}~(b) mostra uma interface gráfica para \textit{smartphone} desenvolvida para reiniciar ou interromper a execução de uma regra. Este ferramental facilita o teste de regras de contexto pois não exige a aquisição de dispositivos reais, como sensores e atuadores. Isto é útil em fases iniciais para os desenvolvedores e facilita a personalização por parte dos usuários finais no dia-a-dia.

\begin{figure}[ht]
  \centering
  \includegraphics[height=.3\textwidth]{imgs/ipgap/ipgap1_dupla.png}
  \caption{Interface de Prototipagem}
  \label{fig:ipgap}
\end{figure}

%[ FALAR DA GUI DE CRIAÇÃO DE REGRAS ]
Atualmente está em andamento o desenvolvimento de uma interface gráfica integrada com o mapa da IPGAP para possibilitar a usuários sem experiência técnica a criar, editar, desabilitar, etc., regras para o seu dia-a-dia. A interface permitirá que, com poucos toques, um usuário possa selecionar ARs em um mapa da casa, escolher as VCs (como mostrado na Figura~\ref{fig:ipgap}~(a)), comparar com valores ou outras VCs (operadores de comparação: $=, \neq, <, >, \leq$ e $\geq$), montar a expressão lógica (operadores lógicos: ``\textit{E}'', ``\textit{OU}'', ``\textit{NÃO}''), e definir um conjunto de ações a serem desempenhadas no sistema em uma segunda etapa. A definição do conjunto de ações pode ser feita tanto ao se escolher ARs atuadores para entrar em ação (e.g., Atuador Lembrar Usuário), como selecionando ARs no mapa e suas OPs em seguida (e.g., ar-condicionado - mudar temperatura - 20º). Através do mecanismo de subscrição os ICs notificarão os ARs atuadores, que executarão tarefas no AmbI através de chamadas RPC.

\subsubsection{Conflitos}
% [ EXPLICAÇÃO DO QUE É CONFLITO E EXEMPLO ]
A detecção e resolução de conflitos visa identificar a criação de regras auto-exclusivas. O conflito ocorre quando dois ICs possuem expressões que se intercedem enquanto os atuadores respectivos possuem ações opostas. Considere as seguintes regras:
\begin{itemize}
\item Se fogão ligado e temperatura $>$ 140 por 15min, então abaixa temperatura
\item Se fogão ligado e temperatura $<$ 160 por 15min, então aumenta temperatura
\end{itemize}
Neste exemplo o fogão não foi esquecido ligado, ele foi deixado assando um bolo. O usuário criou uma regra para controlar a temperatura, quando já havia outra cadastrada que tinha ação oposta mas poderia ocorrer ao mesmo tempo. As regras estão, portanto, em conflito, pois não está claro como o sistema deve agir.

% [ SOLUÇÃO PARA RESOLUÇÃO DE CONFLITOS ]
A solução para este tipo de conflito, envolve a comparação das expressões de um novo IC com os já existentes (no momento da ligação com o atuador); e, caso encontradas expressões que se intercedam, conferir as ações dos atuadores para ver se são do mesmo tipo mas com diferentes entradas. O desenvolvimento desta abordagem para resolução de conflitos está atualmente em andamento.% e será melhor discutida em um trabalho futuro.

% \subsubsection{Loja de Aplicações} \label{subsubsec-loja}
% [ FALAR DA POSSIBILIDADE DE COMPRA DE APLICATIVOS EM UMA LOJA WEB, E QUE ELAS INTRODUZEM TAMBÉM REGRAS NO SISTEMA QUE SÃO GERENCIADAS E REAPROVEITADAS DE MANEIRA HOMOGÊNEA ]

%%%%%%%%%%%%%%%%%%%
%  CASOS DE USO   %
%%%%%%%%%%%%%%%%%%%
\section{SmartAndroid} \label{sec-implement}
% [ SOBRE O SMARTANDROID ]
O desenvolvimento deste projeto se consolidou na implementação da plataforma \mbox{\textit{SmartAndroid}}\footnote{Para mais informações visite www.tempo.uff.br/smartandroid}, desenvolvido a partir de conceitos propostos em três dissertações de mestrado, em andamento, de autores deste artigo. O projeto contempla a implementação das APIs do \textit{framework}, assim como a interface de prototipagem IPGAP, sobre a plataforma Android. 

% [ OUTRAS APLICAÇÕES ]
Algumas aplicações foram costruídas para explorar o potencial do \textit{framework} para sensibilidade ao contexto. Dentre estas aplicações podemos citar: o SmartLiC (uma aplicação de controle de iluminação residencial) que faz com que, conforme usuários deixam um cômodo, as luzes do mesmo sejam apagadas; o MediaFollowMe, que faz com que um fluxo multimídia (e.g., vídeo, audio, imagens) seja repassado para o dispositivo (capaz de apresentar o fluxo) mais próximo do usuário, como se a mídia o seguisse; foram também construídas aplicações do tipo controle remoto, onde recursos são controlados remotamente por outro recurso (no caso, um \textit{smartphone}); dentre outras aplicações.

\subsection{Exemplo de Aplicação} \label{subsec-regrafog}
% [ MOTIVAÇÃO DO EXEMPLO ]
Como já abordado em seções anteriores, a Regra do Fogão Esquecido foi criada pensando em idosos que moram sozinhos e por vezes esquecem o fogão ligado, sendo um motivo de preocupação a sua própria segurança e de seus vizinhos. A utilização de elementos do dia-a-dia nesta regra (i.e., fogão, cama, TV), assim como em outras criadas, reflete o compromisso da abordagem em efetivamente tornar os recursos integrados ao AmbI, possibilitando a construção de regras de contexto e aplicações em alto nível.

% [ USO DE SIMULADORES ]
Este caso de uso já foi abordado na Seção~\ref{sec-proposta} e é ilustrado nas figuras~\ref{fig:arquitetura}~e~\ref{fig:inpt_cute}. Para sua implementação não foram usados recursos reais, ou seja, os eletrodomésticos relevantes. Contudo, foram criados simuladores para representar os recursos cujos ARs possuem a mesma hierarquia de tipos e as operações aplicadas desencadeiam reações apropriadas (e.g., ao mudar a temperatura do forno chamando a OP ``\textit{Set Temperature}'', quem estiver subscrito à VC ``\textit{Temperature}'' é notificado).

% [ MODIFICAÇÃO 1: REGRA COM PARENTESES ]
Algumas modificações foram feitas à regra de contexto original a fim de validar outras propriedades do Interpretador de Contexto. Na expressão original se fazia: ``fogão ligado E pessoa deitada na cama POR 15min'', o que permitiu validarmos a ligação entre as CVs e o IC, a temporização do IC, e a ligação com o atuador. Introduzimos em seguida a possibilidade da pessoa dormir no sofá, criando uma expressão um pouco mais complicada, da seguinte forma: ``fogão ligado E (pessoa deitada na cama OU no sofá) POR 15min''.

%[ MODIFICAÇÃO 2: MUDAR A POSIÇÃO DO TEMPORIZADOR (COLOCAR JUNTO DE PESSOA)]
A fim de verificarmos o funcionamento do temporizador em diferentes lugares na expressão da regra, criamos o exemplo ``fogão ligado E (pessoa deitada na cama OU no sofá POR 15min)''. Assim, este IC é indiferente a quanto tempo o fogão está ligado, se preocupando com a quantidade de tempo que ele foi deixado sozinho enquanto a pessoa dormia.

%[ MODIFICAÇÃO 3: MODIFICAR A REGRA PARA LIDAR COM MAIS DE UMA PESSOA DENTRO DA CASA ]
Para tolerar a presença de mais pessoas na casa, sem confundir quem está deitada na cama, bastou substituir na expressão a cama, pelo sensor de presença da cozinha. A regra ficou assim: ``fogão ligado E (cozinha vazia POR 15min)''. Essa regra assume que, se de tempos em tempos (menos de 15min) alguém entra na cozinha e o fogão ligado, então o fogão está sendo vigiado, senão foi esquecido.

%[ DECLARAÇÃO DE ATUADORES ]
A ligação com os atuadores foi feita de duas formas nos exemplos: declarando um atuador no arquivo da expressão da regra, definindo ação a ação (e.g., desligar fogão, mostrar determinada mensagem na TV do quarto); e ligando um atuador existente a um IC também já instanciado (e.g., além do atuador que desliga o fogão e mostra mensagem na TV, ligar outro que envia um SMS para alguém da família).

%_________________________________________________________________________________________%

%%%%%%%%%%%%%%%%
% RELACIONADOS %
%%%%%%%%%%%%%%%%
\section{Trabalhos Relacionados} \label{sec-trab_rel}
%[ CASS ]
Em \cite{park2007cass} é proposto um sistema para simulação de ciência ao contexto para \textit{Smart Homes}. Este trabalho se foca na simulação de regras de contexto a fim de se descobrir possíveis conflitos, mas não provê suporte para a implantação das regras em ambiente de execução.

%[ DIOS++ ]
Em \cite{liu2003dios++} é proposto um framework que propõe abstrações para se lidar com os sensores e atuadores; uma camada de comunicação para gerenciar e controlar os sensores e atuadores distribuídos; e um motor de regras distribuído, que possibilita o gerenciamento de regras em tempo de execução. No entanto, não é tratada a questão da temporização das regras de contexto, nem a criação de regras em nível de usuário final.

[ FALAR DO DeyAbowd-ContextToolkit ]

% olhar o hydrogen e o cobra)
%JESS ontologia OSGi
%RuleModel Wang
%Augusto
%chen

% [ TRABALHOS COM MOTORES DE REGRAS ]
Alguns trabalhos utilizam um motor de regras para avaliar as regras de contexto~\cite{wang2005towards}~\cite{chen2010context}~\cite{biegel2004framework}. Embora o \textit{framework} proposto não imponha a utilização de um motor de regras, e o SmartAndroid não faça uso de um, este poderia ser facilmente agregado e se aproveitar da infraestrutura de acesso aos recursos.

%_________________________________________________________________________________________%

%%%%%%%%%%%%%
% CONCLUSÃO %
%%%%%%%%%%%%%
\section{Conclusão e Trabalhos Futuros} \label{sec-conclusao}
[ REESCREVER ESTA SEÇÃO ]
%[ FALAR SOBRE O RESULTADO DO QUE FOI VISTO ]
Em ambientes inteligentes, aplicações ubíquas não são pequenas e monolíticas, mas sistemas complexos. Neste artigo foi proposta uma solução para a representação de informações contextuais, distribuição das mesmas em ambientes inteligentes, e interpretação do contexto, facilitando o desenvolvimento de aplicações ubíquas. A proposta possibilita que sejam criadas regras de contexto em alto nível a partir de expressões lógicas, que relacionam variáveis de contexto entre si e com temporizadores.
%falar da GUi

[ TRABALHOS FUTUROS ]

\bibliographystyle{sbc}
\bibliography{references}

\end{document}
xxxxxxxxxxxxxxxxxxxx